import streamlit as st
from reportlab.pdfgen import canvas
from reportlab.pdfbase import pdfmetrics
from reportlab.pdfbase.ttfonts import TTFont
import arabic_reshaper
from bidi.algorithm import get_display
import os

st.set_page_config(page_title="ุจุฑูุงูุฌ ุงูุจูุงุก ุจุงููุดุงุฑูุฉ", layout="wide")
st.title("๐๏ธ ุจุฑูุงูุฌ ุงูุจูุงุก ุจุงููุดุงุฑูุฉ - ูุงุฆูุฉ ุงููุฑุงุฌุนุฉ ูุงูุญุงุณุจุฉ")

# --- ูุงุฆูุฉ ุงููุฑุงุฌุนุฉ ---
st.header("โ ูุงุฆูุฉ ุงููุฑุงุฌุนุฉ")
checklist_items = [
    "ุตูุฑุฉ ูู ุนูุฏ ุงูููููุฉ (ููุซู)",
    "ุฎูู ุงูุฃุฑุถ ูู ุฃู ูุฒุงุนุงุช ูุถุงุฆูุฉ",
    "ูุทุงุจูุฉ ุงููุณุงุญุฉ",
    "ุฏุฑุงุณุฉ ุณุนุฑ ุงููุชุฑ ูู ุงูููุทูุฉ",
    "ูุนุฑูุฉ ุงูููุงูุณูู",
    "ุชุญุฏูุฏ ูุณุจุฉ ุงููุดุงุฑูุฉ",
    "ุชุญุฏูุฏ ุงูุชุฒุงูุงุช ูู ุทุฑู",
    "ูุฏุฉ ุงูุชูููุฐ ูููุนุฏ ุงูุชุณููู",
    "ุญู ุงููุฒุงุนุงุช",
    "ุชูุซูู ุงูุนูุฏ",
    "ุงุณุชุฎุฑุงุฌ ุงูุชุฑุงุฎูุต ูุงููุฉ",
    "ุชุนููู ูููุฏุณ ุงุณุชุดุงุฑู",
    "ูุฑุงุฌุนุฉ ุงูุชุตูููุงุช",
    "ุชูุฏูุฑ ุชูููุฉ ุงูุฅูุดุงุก",
    "ุฅุถุงูุฉ ุงุญุชูุงุทู 10-15%",
    "ุชุญุฏูุฏ ูุตุฏุฑ ุงูุชูููู",
    "ุงุฎุชูุงุฑ ููุงูู",
    "ุฌุฏูู ุฒููู ูุญุฏุฏ",
    "ูุชุงุจุนุฉ ุงูุฌูุฏุฉ",
    "ุชุญุฏูุฏ ุณุนุฑ ุงููุชุฑ ุงูููุงุฆู",
    "ุญุณุงุจ ูุตุงุฑูู ุงูุฃูู ูุงูุตูุงูุฉ",
    "ุฅุถุงูุฉ ูุตุงุฑูู ุงูุชุฑุงุฎูุต",
    "ุชุญุฏูุฏ ุงูููุฏู ูุงูุฃูุณุงุท",
    "ุชุญุฏูุฏ ุงููุงุฆุฏุฉ ุงูุณูููุฉ",
    "ุชุฌููุฒ ุฌุฏูู ุฏูุน",
    "ุชุตููู ูุชุงููุฌ",
    "ุฎุทุฉ ุชุณููู",
    "ุจูุฏ ุฎุฏูุฉ ูุง ุจุนุฏ ุงูุจูุน",
    "ุตูุงุบุฉ ุนูุฏ ุจูุน",
    "ุจูุฏ ุชุณููู ุงููุญุฏุฉ",
    "ุฅูุตุงูุงุช ุงุณุชูุงู",
    "ุทุฑู ุงูุฏูุน",
    "ุชุนููู ุญุงุฑุณ/ุจูุงุจ",
    "ุฎุทุฉ ุตูุงูุฉ ุฏูุฑูุฉ",
    "ููุฒุงููุฉ ุงูุฃูู ูุงูุตูุงูุฉ"
]

completed_items = []
for item in checklist_items:
    checked = st.checkbox(item)
    if checked:
        completed_items.append(item)

# --- ุงูุญุงุณุจุฉ ---
st.header("๐ ุงูุญุงุณุจุฉ")
ุณุนุฑ_ุงููุชุฑ = st.number_input("ุณุนุฑ ุงููุชุฑ:", min_value=0.0, value=20000.0, step=500.0)
ูุณุงุญุฉ_ุงูุดูุฉ = st.number_input("ูุณุงุญุฉ ุงูุดูุฉ (ูุชุฑ ูุฑุจุน):", min_value=0.0, value=150.0, step=10.0)
ุนุฏุฏ_ุงูุดูู_ูู_ุงูุฏูุฑ = st.number_input("ุนุฏุฏ ุงูุดูู ูู ุงูุฏูุฑ:", min_value=1, value=4, step=1)
ุนุฏุฏ_ุงูุงุฏูุงุฑ = st.number_input("ุนุฏุฏ ุงูุฃุฏูุงุฑ:", min_value=1, value=6, step=1)
ุงุฌูุงูู_ุนุฏุฏ_ุงูุดูู = ุนุฏุฏ_ุงูุดูู_ูู_ุงูุฏูุฑ * ุนุฏุฏ_ุงูุงุฏูุงุฑ
ุณุนุฑ_ุงููุญุฏุฉ = ุณุนุฑ_ุงููุชุฑ * ูุณุงุญุฉ_ุงูุดูุฉ
ุงุฌูุงูู_ุงูุงูุฑุงุฏุงุช = ุงุฌูุงูู_ุนุฏุฏ_ุงูุดูู * ุณุนุฑ_ุงููุญุฏุฉ

ุชูููุฉ_ุงูุจูุงุก = st.number_input("ุฅุฌูุงูู ุชูููุฉ ุงูุจูุงุก (ุฌููู):", min_value=0.0, value=30816000.0, step=100000.0)

ูุฑุชุจ_ุงูุญุงุฑุณ = st.number_input("ูุฑุชุจ ุงูุญุงุฑุณ (ุดูุฑููุง):", min_value=0.0, value=5000.0, step=500.0)
ุตูุงูุฉ_ุฏูุฑูุฉ = st.number_input("ุงูุตูุงูุฉ ุงูุฏูุฑูุฉ (ุดูุฑููุง):", min_value=0.0, value=4000.0, step=500.0)
ุฎุฏูุงุช_ูุดุชุฑูุฉ = st.number_input("ูุตุงุฑูู ุงูุฎุฏูุงุช ุงููุดุชุฑูุฉ (ุดูุฑููุง):", min_value=0.0, value=2000.0, step=500.0)
ุงุฏุงุฑุฉ_ุงูุนูุงุฑ = st.number_input("ุฅุฏุงุฑุฉ ุงูุนูุงุฑ (ุดูุฑููุง):", min_value=0.0, value=3000.0, step=500.0)
ุงุฌูุงูู_ุงูุงูู_ูุงูุตูุงูุฉ_ุงูุณููู = (ูุฑุชุจ_ุงูุญุงุฑุณ + ุตูุงูุฉ_ุฏูุฑูุฉ + ุฎุฏูุงุช_ูุดุชุฑูุฉ + ุงุฏุงุฑุฉ_ุงูุนูุงุฑ) * 12
ุงูุชูููุฉ_ููู_ุดูุฉ = ุงุฌูุงูู_ุงูุงูู_ูุงูุตูุงูุฉ_ุงูุณููู / ุงุฌูุงูู_ุนุฏุฏ_ุงูุดูู

ุตุงูู_ุงูุฑุจุญ = ุงุฌูุงูู_ุงูุงูุฑุงุฏุงุช - ุชูููุฉ_ุงูุจูุงุก
ูุณุจุฉ_ุงููุทูุฑ = st.number_input("ูุณุจุฉ ุงููุทูุฑ (%):", min_value=0, max_value=100, value=50, step=5)
ุญุตุฉ_ุงููุทูุฑ = ุตุงูู_ุงูุฑุจุญ * (ูุณุจุฉ_ุงููุทูุฑ / 100)
ุญุตุฉ_ุงููุงูู = ุตุงูู_ุงูุฑุจุญ - ุญุตุฉ_ุงููุทูุฑ

ููุฏู_ุงูุญุฌุฒ_ูุณุจุฉ = st.number_input("ูุณุจุฉ ุงูููุฏู (%):", min_value=0, max_value=100, value=25, step=5)
ููุฏู_ุงูุญุฌุฒ = ุณุนุฑ_ุงููุญุฏุฉ * (ููุฏู_ุงูุญุฌุฒ_ูุณุจุฉ / 100)
ุจุงูู_ุงููุจูุบ = ุณุนุฑ_ุงููุญุฏุฉ - ููุฏู_ุงูุญุฌุฒ
ูุณุจุฉ_ุงููุงุฆุฏุฉ_ุณูููุง = st.number_input("ูุณุจุฉ ุงููุงุฆุฏุฉ ุงูุณูููุฉ (%):", min_value=0.0, max_value=30.0, value=10.0, step=0.5)
ูุฏุฉ_ุงูุชูููุฐ = st.number_input("ูุฏุฉ ุงูุชูููุฐ (ุดููุฑ):", min_value=1, max_value=60, value=24, step=1)
ุงููุงุฆุฏุฉ_ุงูุณูููุฉ = ุจุงูู_ุงููุจูุบ * (ูุณุจุฉ_ุงููุงุฆุฏุฉ_ุณูููุง / 100)
ุงุฌูุงูู_ุงููุงุฆุฏุฉ = ุงููุงุฆุฏุฉ_ุงูุณูููุฉ * (ูุฏุฉ_ุงูุชูููุฐ / 12)
ุงุฌูุงูู_ุงููุณุชุญู = ุจุงูู_ุงููุจูุบ + ุงุฌูุงูู_ุงููุงุฆุฏุฉ
ุงููุณุท_ุงูุดูุฑู = ุงุฌูุงูู_ุงููุณุชุญู / ูุฏุฉ_ุงูุชูููุฐ

# --- ุฒุฑุงุฑ ุชุญููู PDF ---
if st.button("๐ ุญูุธ ุงููุชุงุฆุฌ ูู PDF"):
    pdf_file = "ูุชุงุฆุฌ_ุงูุจูุงุก_ุจุงููุดุงุฑูุฉ.pdf"
    c = canvas.Canvas(pdf_file, pagesize=(595, 842))
    
    font_path = "arial.ttf"  # ุชุฃูุฏ ูู ูุฌูุฏ ุงูุฎุท ูู ููุณ ุงููุณุงุฑ
    if os.path.exists(font_path):
        pdfmetrics.registerFont(TTFont("Arabic", font_path))
        c.setFont("Arabic", 14)
    else:
        c.setFont("Helvetica", 14)

    def draw_arabic_text(c, x, y, text):
        reshaped_text = arabic_reshaper.reshape(text)
        bidi_text = get_display(reshaped_text)
        c.drawRightString(x, y, bidi_text)  # ูู ุงููููู ูููุณุงุฑ

    y = 800
    draw_arabic_text(c, 550, y, "ูุชุงุฆุฌ ุงูุจูุงุก ุจุงููุดุงุฑูุฉ:")

    y -= 20
    draw_arabic_text(c, 550, y, "โ ูุงุฆูุฉ ุงููุฑุงุฌุนุฉ:")
    y -= 20
    for item in checklist_items:
        status = "โ๏ธ" if item in completed_items else "โ"
        draw_arabic_text(c, 550, y, f"{status} {item}")
        y -= 15
        if y < 100:
            c.showPage()
            y = 800

    y -= 10
    draw_arabic_text(c, 550, y, "๐ ุงูุญุงุณุจุฉ:")
    y -= 20
    draw_arabic_text(c, 550, y, f"ุฅุฌูุงูู ุนุฏุฏ ุงูุดูู: {ุงุฌูุงูู_ุนุฏุฏ_ุงูุดูู}")
    y -= 15
    draw_arabic_text(c, 550, y, f"ุณุนุฑ ุงููุญุฏุฉ: {ุณุนุฑ_ุงููุญุฏุฉ:,.0f} ุฌููู")
    y -= 15
    draw_arabic_text(c, 550, y, f"ุฅุฌูุงูู ุงูุฅูุฑุงุฏุงุช: {ุงุฌูุงูู_ุงูุงูุฑุงุฏุงุช:,.0f} ุฌููู")
    y -= 15
    draw_arabic_text(c, 550, y, f"ุตุงูู ุงูุฑุจุญ: {ุตุงูู_ุงูุฑุจุญ:,.0f} ุฌููู")
    y -= 15
    draw_arabic_text(c, 550, y, f"ุญุตุฉ ุงููุทูุฑ: {ุญุตุฉ_ุงููุทูุฑ:,.0f} ุฌููู")
    y -= 15
    draw_arabic_text(c, 550, y, f"ุญุตุฉ ุงููุงูู: {ุญุตุฉ_ุงููุงูู:,.0f} ุฌููู")
    y -= 15
    draw_arabic_text(c, 550, y, f"ุฅุฌูุงูู ุงูุฃูู ูุงูุตูุงูุฉ: {ุงุฌูุงูู_ุงูุงูู_ูุงูุตูุงูุฉ_ุงูุณููู:,.0f} ุฌููู")
    y -= 15
    draw_arabic_text(c, 550, y, f"ุงููุณุท ุงูุดูุฑู: {ุงููุณุท_ุงูุดูุฑู:,.0f} ุฌููู")
    
    c.save()

    with open(pdf_file, "rb") as f:
        st.download_button("๐ฅ ุชุญููู PDF", f, file_name=pdf_file)
